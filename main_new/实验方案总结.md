# 消融实验与参数敏感性分析方案总结

## ✅ 已完成的工作

### 1. 实验方案设计文档

**文件**: `实验方案_消融与敏感性分析.md`

包含：
- ✅ 4组消融实验设计（11个实验）
- ✅ 4项参数敏感性分析方案
- ✅ 详细的实验配置说明
- ✅ 预期结果和假设

### 2. 自动化实验脚本

#### 消融实验脚本
**文件**: `run_ablation_experiments.py`

功能：
- ✅ 自动运行所有消融实验
- ✅ 自动训练和评估
- ✅ 结果汇总和错误处理
- ✅ 实验状态跟踪

#### 参数敏感性分析脚本
**文件**: `run_sensitivity_analysis.py`

功能：
- ✅ 自动运行参数敏感性分析
- ✅ 支持多参数分析
- ✅ 结果自动保存

### 3. 结果分析脚本

**文件**: `analyze_results.py`

功能：
- ✅ 自动提取实验结果指标
- ✅ 生成CSV报告
- ✅ 生成可视化图表
- ✅ 计算改进幅度

### 4. 快速使用指南

**文件**: `实验快速指南.md`

包含：
- ✅ 快速开始步骤
- ✅ 结果解读方法
- ✅ 故障排除指南
- ✅ 最佳实践建议

## 📋 实验清单

### 消融实验（11个）

| ID | 实验名称 | 配置 | 目的 |
|---|---------|------|------|
| Baseline | 原始DACAD | 单尺度域对抗 | 基准对比 |
| Exp-1.1 | 完整多尺度 | 3层多尺度+单尺度 | 验证多尺度有效性 |
| Exp-1.2 | 仅多尺度 | 仅3层多尺度 | 验证单尺度必要性 |
| Exp-2.1 | 仅低层 | Layer 1 | 分析低层贡献 |
| Exp-2.2 | 仅中层 | Layer 2 | 分析中层贡献 |
| Exp-2.3 | 仅高层 | Layer 3 | 分析高层贡献 |
| Exp-2.7 | 所有层 | All Layers | 完整配置 |
| Exp-3.1 | 默认权重 | [0.1,0.3,0.6] | 默认配置 |
| Exp-3.2 | 均匀权重 | [0.33,0.33,0.34] | 权重均匀性 |
| Exp-3.3 | 反向权重 | [0.6,0.3,0.1] | 权重方向性 |

### 参数敏感性分析（1项）

| 分析项 | 参数 | 范围 | 步数 |
|-------|------|------|------|
| 多尺度损失权重 | weight_loss_ms_disc | 0.0-0.7 | 8 |

## 🎯 实验目标

### 主要验证点

1. **多尺度域对抗的有效性**
   - 假设：多尺度 > 单尺度（+2-5% AUPRC）
   - 验证：Exp-1.1 vs Baseline

2. **不同层的相对重要性**
   - 假设：高层 > 中层 > 低层
   - 验证：Exp-2.3 vs Exp-2.2 vs Exp-2.1

3. **权重配置的影响**
   - 假设：默认权重最优
   - 验证：Exp-3.1 vs Exp-3.2 vs Exp-3.3

4. **参数敏感性**
   - 假设：最优权重在0.2-0.4之间
   - 验证：敏感性分析结果

## 📊 预期输出

### 消融实验输出

1. **CSV报告**: `ablation_results_analysis.csv`
   - 所有实验的指标对比
   - 改进幅度计算

2. **JSON摘要**: `ablation_results_summary.json`
   - 实验状态汇总
   - 配置信息

### 敏感性分析输出

1. **CSV报告**: `sensitivity_analysis_weight_loss_ms_disc.csv`
   - 不同参数值的性能指标

2. **可视化图表**: `sensitivity_analysis_weight_loss_ms_disc.png`
   - AUPRC vs 参数值
   - F1 Score vs 参数值
   - Precision vs 参数值
   - Recall vs 参数值

3. **JSON摘要**: `sensitivity_analysis_results.json`
   - 分析结果汇总

## 🚀 使用方法

### 快速开始

```bash
# 1. 运行消融实验（约20小时）
python main_new/run_ablation_experiments.py

# 2. 运行敏感性分析（约16小时）
python main_new/run_sensitivity_analysis.py

# 3. 分析结果
python main_new/analyze_results.py
```

### 分步执行

```bash
# 只运行特定实验（修改脚本中的EXPERIMENTS字典）
python main_new/run_ablation_experiments.py

# 只分析特定参数（修改脚本中的分析函数）
python main_new/run_sensitivity_analysis.py
```

## 📈 结果分析指南

### 1. 消融实验结果分析

**关键问题**：
- 多尺度域对抗是否有效？
- 哪个层的贡献最大？
- 权重配置是否重要？

**分析方法**：
```python
import pandas as pd
df = pd.read_csv('ablation_results_analysis.csv')

# 查看最佳性能
print(df.sort_values('AUPRC', ascending=False).head())

# 计算改进
baseline = df[df['Experiment'] == 'Baseline']['AUPRC'].values[0]
improvements = df['AUPRC'] - baseline
print(improvements.sort_values(ascending=False))
```

### 2. 敏感性分析结果分析

**关键问题**：
- 最优参数值是多少？
- 参数敏感性如何？
- 稳定区间在哪里？

**分析方法**：
```python
import pandas as pd
import matplotlib.pyplot as plt

df = pd.read_csv('sensitivity_analysis_weight_loss_ms_disc.csv')

# 找到最优值
best_idx = df['AUPRC'].idxmax()
print(f"Optimal value: {df.loc[best_idx, 'weight_loss_ms_disc']}")

# 绘制曲线
plt.plot(df['weight_loss_ms_disc'], df['AUPRC'])
plt.xlabel('weight_loss_ms_disc')
plt.ylabel('AUPRC')
plt.show()
```

## ⚠️ 注意事项

1. **资源需求**
   - GPU内存：建议至少8GB
   - 存储空间：每个实验约500MB
   - 总时间：约36小时（单GPU）

2. **实验顺序**
   - 建议先运行消融实验
   - 再运行敏感性分析
   - 最后分析结果

3. **结果备份**
   - 定期备份 `results/` 目录
   - 保存实验配置
   - 记录异常情况

## 📚 相关文件

- `实验方案_消融与敏感性分析.md`: 详细实验方案
- `实验快速指南.md`: 快速使用指南
- `run_ablation_experiments.py`: 消融实验脚本
- `run_sensitivity_analysis.py`: 敏感性分析脚本
- `analyze_results.py`: 结果分析脚本

## 🎓 实验设计亮点

1. **系统性**：覆盖所有关键组件
2. **自动化**：一键运行所有实验
3. **可复现**：固定随机种子
4. **可扩展**：易于添加新实验
5. **结果可视化**：自动生成图表

## 📝 下一步建议

1. **运行实验**：按照快速指南执行
2. **分析结果**：使用分析脚本生成报告
3. **撰写报告**：基于结果撰写实验报告
4. **优化参数**：根据敏感性分析结果优化
5. **扩展实验**：在其他数据集上验证

